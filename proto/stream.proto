syntax = "proto3";

package stream;

import "google/protobuf/timestamp.proto";

option go_package = "rpc/stream";

service StreamAService {
  rpc ReceiveUpdates(SubscribeRequest) returns (stream Subscribe);

  rpc Send(ChatMessage) returns (SendResponse);

  rpc SendQuestion(Question) returns (SendResponse);

  rpc WindowPaint(PaintEvent) returns (SendResponse);

  rpc WindowPaintInit(PaintEventInit) returns (SendResponse);
}

message PaintEventInit {
  string chat_room = 3;
  bool init = 1;
}

message StreamVertex {
  repeated float position = 1;
  repeated float color = 2;
}

message StreamRect {
  float x = 1;
  float y = 2;
  float width = 3;
  float height = 4;
}

message StreamTextEntries {
  repeated float position = 1;
  repeated float color = 2;  
  string text = 7;
  bool pending = 8;
  StreamRect bounds = 9;
  int32 font_size = 10;
}

message StreamRectangle {
  repeated float first = 1;
  repeated float last = 2;
  repeated float color = 3;
}

message StreamAction {
  repeated StreamVertex vertices = 1;
  StreamTextEntries text = 2;
  StreamRectangle rectangle = 3;
}

message StreamActions {
  repeated StreamAction actions = 1;
}

message WindowPaintHistoryResponse {
  repeated PaintEvent paints = 1;
}

message QuestionsHistoryRequest {
  string chat_room = 1;
}

message QuestionsHistoryResponse {
  repeated Question questions = 1;
}

message SendResponse {
  bool success = 1;
}

message ChatMessage {
  string chat_room = 1;
  string username = 2;
  string message = 3;
  int64 timestamp = 4;
}

message PaintEvent {
  repeated StreamActions actions = 1;
  string chat_room = 2;
  google.protobuf.Timestamp timestamp = 3;
}

message Question {
  string chat_room = 1;
  string text = 2;
  repeated string answers = 3;
}

message Subscribe {
  oneof data {
    ChatMessage chat_message = 1;
    PaintEvent paint_event = 2;
    Question question = 3;
    PaintEventInit paint_event_init = 4;
  }
  string chat_romm = 5;
  string username = 6;
}

message SubscribeRequest {
  string chat_room = 1;
  string username = 2;
};